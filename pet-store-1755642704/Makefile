.PHONY: help serve build clean install dev

# Default target
help:
	@echo "ğŸ¾ Paws & Whiskers Pet Store - Available Commands:"
	@echo ""
	@echo "  serve     - Start local development server (Python)"
	@echo "  dev       - Start local development server (Node.js)"
	@echo "  build     - Create production build"
	@echo "  clean     - Clean build artifacts"
	@echo "  install   - Install dependencies"
	@echo "  help      - Show this help message"
	@echo ""

# Start local development server using Python's built-in server
serve:
	@echo "ğŸš€ Starting development server..."
	@echo "ğŸ“ Opening http://localhost:8000"
	@echo "ğŸ›‘ Press Ctrl+C to stop"
	@python3 -m http.server 8000

# Alternative development server using Node.js (if available)
dev:
	@echo "ğŸš€ Starting Node.js development server..."
	@echo "ğŸ“ Opening http://localhost:3000"
	@if command -v npx >/dev/null 2>&1; then \
		npx serve -s . -l 3000; \
	else \
		echo "âŒ Node.js/npx not found. Using Python server instead..."; \
		make serve; \
	fi

# Create production build (minify CSS/JS)
build:
	@echo "ğŸ”¨ Building production version..."
	@mkdir -p dist
	@cp index.html dist/
	@echo "ğŸ“¦ Minifying CSS..."
	@if command -v cleancss >/dev/null 2>&1; then \
		cleancss -o dist/styles.css styles.css; \
	else \
		cp styles.css dist/; \
		echo "âš ï¸  cleancss not found, copied CSS without minification"; \
	fi
	@echo "ğŸ“¦ Minifying JavaScript..."
	@if command -v uglifyjs >/dev/null 2>&1; then \
		uglifyjs script.js -o dist/script.js -c -m; \
	else \
		cp script.js dist/; \
		echo "âš ï¸  uglifyjs not found, copied JS without minification"; \
	fi
	@echo "âœ… Build complete! Files are in the 'dist' directory"

# Install build dependencies
install:
	@echo "ğŸ“¦ Installing build dependencies..."
	@if command -v npm >/dev/null 2>&1; then \
		npm install -g clean-css-cli uglify-js serve; \
		echo "âœ… Dependencies installed successfully"; \
	else \
		echo "âŒ npm not found. Please install Node.js first"; \
		echo "ğŸ’¡ You can still use 'make serve' with Python"; \
	fi

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@rm -rf dist/
	@echo "âœ… Clean complete!"

# Deploy to GitHub Pages (if repository is set up)
deploy:
	@echo "ğŸš€ Deploying to GitHub Pages..."
	@if [ -d ".git" ]; then \
		make build; \
		git add dist/; \
		git commit -m "Deploy: Update GitHub Pages build"; \
		git push origin main; \
		echo "âœ… Deployed successfully!"; \
	else \
		echo "âŒ Not a git repository. Initialize git first."; \
	fi

# Validate HTML/CSS
validate:
	@echo "ğŸ” Validating HTML and CSS..."
	@if command -v html5validator >/dev/null 2>&1; then \
		html5validator --root .; \
	else \
		echo "âš ï¸  html5validator not found. Install with: pip install html5validator"; \
	fi
	@echo "âœ… Validation complete!"

# Open in browser
open:
	@echo "ğŸŒ Opening website in browser..."
	@if command -v open >/dev/null 2>&1; then \
		open http://localhost:8000; \
	elif command -v xdg-open >/dev/null 2>&1; then \
		xdg-open http://localhost:8000; \
	else \
		echo "ğŸ“ Please open http://localhost:8000 in your browser"; \
	fi